<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>Những Khoảng Lặng Cần Thiết</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
            color: #333;
        }
        .content {
            max-width: 700px;
            margin: auto;
            background: #fff;
            padding: 32px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
        }
        h1[contenteditable="true"] {
            outline: none;
            border-bottom: 2px solid #2d6a4f;
            padding-bottom: 4px;
            cursor: text;
            user-select: text;
        }
        h1[contenteditable="true"]:focus {
            background-color: #e9f5ee;
        }
        .frame {
            border: 3px solid #2d6a4f;
            border-radius: 12px;
            padding: 16px;
            margin: 24px 0;
            background: #e9f5ee;
            display: flex;
            align-items: stretch; /* Cho các phần con cao bằng nhau */
            gap: 20px;
            min-height: 140px; /* Đảm bảo chiều cao tối thiểu */
        }
        .frame img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            animation: float 2.5s ease-in-out infinite alternate;
        }
        @keyframes float {
            0% { transform: translateY(0); }
            100% { transform: translateY(-18px); }
        }
        .frame-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        .frame-text strong {
            font-size: 1.1em;
            display: block;
            margin-bottom: 8px;
            color: #2d6a4f;
        }
        #frame-desc-editable {
            width: 100%;
            min-height: 90px;
            font-size: 15px;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #a3c1a0;
            resize: vertical;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            color: #333;
        }
        textarea {
            width: 100%;
            min-height: 220px;
            font-size: 16px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            resize: vertical;
            box-sizing: border-box;
            margin-top: 24px;
        }
        #status {
            margin-top: 8px;
            color: #555;
            font-style: italic;
            text-align: right;
            font-size: 14px;
        }
        .back-link {
            display: inline-block;
            margin-top: 32px;
            background: #2d6a4f;
            color: #fff;
            padding: 10px 22px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            transition: background 0.2s;
        }
        .back-link:hover {
            background: #23543c;
        }
        /* CSS cho nút Cải thiện nội dung */
        .improve-btn {
            display: block;
            margin: 12px auto 24px auto;
            background-color: #2d6a4f;
            color: #fff;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .improve-btn:hover {
            background-color: #23543c;
        }
    </style>
</head>
<body>
    <div class="content">
        <h1 id="editable-title" contenteditable="true">Những Khoảng Lặng Cần Thiết</h1>
        <div class="frame">
            <img src="https://images.pexels.com/photos/733857/pexels-photo-733857.jpeg" alt="Khoảng lặng thiên nhiên">
            <div class="frame-text">
                <strong id="frame-title">Khoảng lặng giữa thiên nhiên</strong>
                <textarea id="frame-desc-editable" maxlength="500" spellcheck="false" 
                  title="Chỉnh sửa mô tả (tối đa 500 ký tự)"></textarea>
            </div>
        </div>

        <textarea id="editable-content" spellcheck="false"></textarea>

        <button id="improve-btn" class="improve-btn">Cải thiện nội dung</button>

        <div id="status">Chưa lưu</div>

        <a href="javascript:history.back()" class="back-link">&#8592; Quay lại</a>
    </div>

<script>
  const title = document.getElementById('editable-title');
  const frameTitle = document.getElementById('frame-title');
  const frameDescEditable = document.getElementById('frame-desc-editable');
  const textarea = document.getElementById('editable-content');
  const status = document.getElementById('status');
  const improveBtn = document.getElementById('improve-btn');

  let timer = null;

  const defaultTitle = 'Những Khoảng Lặng Cần Thiết';
  const defaultFrameTitle = 'Khoảng lặng giữa thiên nhiên';
  const defaultFrameDesc = `Đôi khi, chỉ cần ngồi lặng yên giữa không gian xanh mát, lắng nghe tiếng gió và tiếng chim, ta đã có thể cảm nhận sự bình yên lan tỏa trong tâm hồn. Thiên nhiên luôn là nơi chữa lành tuyệt vời cho những tâm hồn mệt mỏi.`;
  const defaultContent = `Trong cuộc sống hối hả, những khoảng lặng là điều cần thiết để mỗi người có thể lắng nghe chính mình. Đó là lúc ta tạm dừng lại, thở sâu và cảm nhận nhịp đập của trái tim, để nhận ra điều gì thực sự quan trọng. Khoảng lặng giúp ta cân bằng cảm xúc, làm dịu tâm trí và tái tạo năng lượng cho những hành trình tiếp theo. Đôi khi, chỉ cần một chút tĩnh lặng, ta đã có thể tìm thấy câu trả lời cho những băn khoăn trong lòng.

Khoảng lặng không chỉ là sự im lặng bên ngoài, mà còn là sự tĩnh lặng bên trong tâm trí. Đó là lúc ta buông bỏ những lo toan, áp lực và cho phép bản thân được nghỉ ngơi. Khi dành thời gian cho những khoảng lặng, ta sẽ nhận ra giá trị của sự chậm lại, của việc sống trọn vẹn từng khoảnh khắc.

Hãy trân trọng những khoảng lặng, dù là ngắn ngủi, bởi đó chính là món quà quý giá giúp ta hiểu mình hơn, mạnh mẽ hơn và sống ý nghĩa hơn mỗi ngày.`;

  // Load dữ liệu từ localStorage hoặc dùng mặc định
  title.textContent = localStorage.getItem('khoangLangTitle') || defaultTitle;
  frameTitle.textContent = localStorage.getItem('khoangLangFrameTitle') || defaultFrameTitle;
  frameDescEditable.value = localStorage.getItem('khoangLangFrameDesc') || defaultFrameDesc;
  textarea.value = localStorage.getItem('khoangLangContent') || defaultContent;

  function saveData() {
    let newTitle = title.textContent.trim();
    let newFrameDesc = frameDescEditable.value.trim();

    // Giới hạn 500 ký tự cho mô tả
    if(newFrameDesc.length > 500) {
      newFrameDesc = newFrameDesc.substring(0, 500);
      frameDescEditable.value = newFrameDesc;
      alert('Phần mô tả giới hạn 500 ký tự.');
    }

    // Khi title thay đổi, tự động cập nhật frameTitle giống title
    frameTitle.textContent = newTitle;

    // Lưu dữ liệu vào localStorage
    localStorage.setItem('khoangLangTitle', newTitle);
    localStorage.setItem('khoangLangFrameTitle', frameTitle.textContent);
    localStorage.setItem('khoangLangFrameDesc', newFrameDesc);
    localStorage.setItem('khoangLangContent', textarea.value);

    // Cập nhật trạng thái
    status.textContent = 'Đã lưu lúc: ' + new Date().toLocaleTimeString();
  }

  function scheduleSave() {
    status.textContent = 'Đang soạn...';
    clearTimeout(timer);
    timer = setTimeout(saveData, 3000);
  }

  // Sự kiện input cho các phần chỉnh sửa
  title.addEventListener('input', scheduleSave);
  frameDescEditable.addEventListener('input', scheduleSave);
  textarea.addEventListener('input', scheduleSave);

  // Hàm viết hoa chữ cái đầu mỗi câu
  function capitalizeFirstLetterOfSentences(text) {
    // Viết hoa chữ đầu câu, câu kết thúc bởi dấu . ! ? (có thể kèm dấu cách)
    return text.replace(/(?:^|[.!?]\s+)(\w)/g, (match) => match.toUpperCase());
  }

  // Xử lý nút Cải thiện nội dung
  improveBtn.addEventListener('click', () => {
    let content = textarea.value.trim();

    // Viết hoa câu đầu trong nội dung
    content = capitalizeFirstLetterOfSentences(content);

    // Thêm ghi chú nếu chưa có
    const note = "\n\n---\nGhi chú: Nội dung đã được cải thiện tự động.";
    if (!content.includes(note.trim())) {
      content += note;
    }

    textarea.value = content;

    // Tự động lưu ngay sau khi cải thiện
    saveData();

    // Cập nhật trạng thái
    status.textContent = 'Đã cải thiện và lưu lúc: ' + new Date().toLocaleTimeString();
  });
</script>
</body>
</html>
